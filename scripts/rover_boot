#!/bin/bash
#DO NOT EDIT THIS FILE.  IT IS MAINTAINED THROUGH EROS.
#Author: David Gitz

ros_master="ControlModule1"
boot_file="/home/robot/logs/output/"$(hostname)"_log.txt"
export ROS_HOSTNAME=$HOSTNAME
export ROS_MASTER_URI=http://$ros_master:11311
export ROS_IP=$HOSTNAME


if [[ $HOSTNAME == *"ControlModule"* ]]; then
    echo "ControlModule booting"
    echo 0 | sudo dd status=none of=/sys/class/leds/led1/brightness 
    
elif [[ $HOSTNAME == *"ComputeModule"* ]]; then
  echo "ComputeModule booting"
  sudo mount /dev/sda1 /home/robot/external/ -o uid=robot -o gid=robot
fi


sleep 5
sudo rm $boot_file
touch $boot_file
#sudo chown robot:robot $boot_file
echo "Starting Boot Script at: "$(date) >> $boot_file
if [[ $HOSTNAME == *"ControlModule"* ]]; then
  echo "ControlModule booting"
  echo "Setting permissions on SPI" >> $boot_file
  sudo chown robot:robot /dev/spidev0.0
  sudo chown robot:robot /dev/spidev0.1
  echo "Setting permissions on Video" >> $boot_file
  sudo chown robot /dev/video0
  sudo chown robot /dev/vchiq
  echo 1 | sudo dd status=none of=/sys/class/leds/led1/brightness
elif [[ $HOSTNAME == *"ComputeModule"* ]]; then
  echo "ComputeModule booting"
fi

if [[ $HOSTNAME == "ControlModule1" ]]; then
  cd /home/robot/catkin_ws
  source /home/robot/catkin_ws/devel/setup.bash
  echo "Starting ROSCore" >> $boot_file
  exec roscore 2> $boot_file > /dev/null &
  sleep 5
fi
echo "Completed Boot at: "$(date) >> $boot_file


echo "Launching Device" 
/home/robot/scripts/launchDevice -d $HOSTNAME

